{% extends "base.html" %}
{% block content %}
<h2>üìä Dashboard</h2>

<h3>V√Ωsledovky</h3>
{% if income_statements %}
<table border="1" cellpadding="5">
  <thead>
    <tr>
      <th>Rok</th>
      <th>Tr≈æby</th>
      <th>N√°klady</th>
      <th>Zisk</th>
      <th>Validace</th>
    </tr>
  </thead>
  <tbody>
    {% for year, data in income_statements.items %}
    <tr>
      <td>{{ year }}</td>
      <td>{{ data.revenue|floatformat:0 }}</td>
      <td>{{ data.costs|floatformat:0 }}</td>
      <td>{{ data.profit|floatformat:0 }}</td>
      <td>
        {% if data.valid %}
          <span style="color: green;">‚úÖ</span>
        {% else %}
          <span style="color: red;">‚ùå</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<canvas id="incomeChart" width="400" height="200"></canvas>
{% else %}
<p>≈Ω√°dn√© v√Ωsledovky</p>
{% endif %}


<h3>Rozvahy</h3>
{% if balance_sheets %}
<table border="1" cellpadding="5">
  <thead>
    <tr>
      <th>Rok</th>
      <th>Aktiva</th>
      <th>Pasiva</th>
      <th>Vlastn√≠ kapit√°l</th>
      <th>Validace</th>
    </tr>
  </thead>
  <tbody>
    {% for year, data in balance_sheets.items %}
    <tr>
      <td>{{ year }}</td>
      <td>{{ data.assets|floatformat:0 }}</td>
      <td>{{ data.liabilities|floatformat:0 }}</td>
      <td>{{ data.equity|floatformat:0 }}</td>
      <td>
        {% if data.valid %}
          <span style="color: green;">‚úÖ</span>
        {% else %}
          <span style="color: red;">‚ùå</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>≈Ω√°dn√© rozvahy</p>
{% endif %}

<hr>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  {% if income_statements %}
  const ctx = document.getElementById('incomeChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: [{% for year, data in income_statements.items %}'{{ year }}',{% endfor %}],
      datasets: [
        {
          label: 'Tr≈æby',
          data: [{% for year, data in income_statements.items %}{{ data.revenue|default:0 }},{% endfor %}],
          borderColor: 'blue',
          fill: false
        },
        {
          label: 'Zisk',
          data: [{% for year, data in income_statements.items %}{{ data.profit|default:0 }},{% endfor %}],
          borderColor: 'green',
          fill: false
        }
      ]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });
  {% endif %}
</script>

{% endblock %}
